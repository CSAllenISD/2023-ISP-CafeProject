{"version":3,"names":["withTiming","supportedProps","SharedTransition","createInstance","custom","animationFactory","build","animationDuration","defaultDuration","values","animations","initialValues","key","includes","Error","propName","matrix","targetTransformMatrix","transformMatrix","duration","keyToTargetValue","charAt","toUpperCase","slice","currentTransformMatrix","keyToCurrentValue","DefaultSharedTransition"],"sources":["index.ts"],"sourcesContent":["import { withTiming } from '../../animation';\nimport {\n  ILayoutAnimationBuilder,\n  LayoutAnimationFunction,\n  LayoutAnimationsValues,\n} from '../animationBuilder/commonTypes';\nimport { StyleProps } from '../../commonTypes';\n\nconst supportedProps = ['width', 'height', 'originX', 'originY', 'transform'];\n\ntype AnimationFactoryType = (values: LayoutAnimationsValues) => StyleProps;\n\nexport class SharedTransition implements ILayoutAnimationBuilder {\n  animationFactory: AnimationFactoryType | null = null;\n  defaultDuration = 500;\n\n  static createInstance(): SharedTransition {\n    return new SharedTransition();\n  }\n\n  static custom(animationFactory: AnimationFactoryType): SharedTransition {\n    return this.createInstance().custom(animationFactory);\n  }\n\n  custom(animationFactory: AnimationFactoryType): SharedTransition {\n    this.animationFactory = animationFactory;\n    return this;\n  }\n\n  static build(): LayoutAnimationFunction {\n    return this.createInstance().build();\n  }\n\n  build(): LayoutAnimationFunction {\n    const animationFactory = this.animationFactory;\n    const animationDuration = this.defaultDuration;\n    return (values: LayoutAnimationsValues) => {\n      'worklet';\n      let animations: {\n        [key: string]: any;\n      } = {};\n      const initialValues: {\n        [key: string]: any;\n      } = {};\n\n      if (animationFactory) {\n        animations = animationFactory(values);\n        for (const key in animations) {\n          if (!supportedProps.includes(key)) {\n            throw Error(`The prop '${key}' is not supported yet.`);\n          }\n        }\n      } else {\n        for (const propName of supportedProps) {\n          if (propName === 'transform') {\n            const matrix = values.targetTransformMatrix;\n            animations.transformMatrix = withTiming(matrix, {\n              // native screen transition takes around 500ms\n              duration: animationDuration,\n            });\n          } else {\n            const keyToTargetValue =\n              'target' + propName.charAt(0).toUpperCase() + propName.slice(1);\n            animations[propName] = withTiming(values[keyToTargetValue], {\n              // native screen transition takes around 500ms\n              duration: animationDuration,\n            });\n          }\n        }\n      }\n\n      for (const propName in animations) {\n        if (propName === 'transform') {\n          initialValues.transformMatrix = values.currentTransformMatrix;\n        } else {\n          const keyToCurrentValue =\n            'current' + propName.charAt(0).toUpperCase() + propName.slice(1);\n          initialValues[propName] = values[keyToCurrentValue];\n        }\n      }\n\n      return { initialValues, animations };\n    };\n  }\n}\n\nexport const DefaultSharedTransition = SharedTransition;\n"],"mappings":";;AAAA,SAASA,UAAT,QAA2B,iBAA3B;AAQA,MAAMC,cAAc,GAAG,CAAC,OAAD,EAAU,QAAV,EAAoB,SAApB,EAA+B,SAA/B,EAA0C,WAA1C,CAAvB;AAIA,OAAO,MAAMC,gBAAN,CAA0D;EAAA;IAAA,0CACf,IADe;;IAAA,yCAE7C,GAF6C;EAAA;;EAI1C,OAAdC,cAAc,GAAqB;IACxC,OAAO,IAAID,gBAAJ,EAAP;EACD;;EAEY,OAANE,MAAM,CAACC,gBAAD,EAA2D;IACtE,OAAO,KAAKF,cAAL,GAAsBC,MAAtB,CAA6BC,gBAA7B,CAAP;EACD;;EAEDD,MAAM,CAACC,gBAAD,EAA2D;IAC/D,KAAKA,gBAAL,GAAwBA,gBAAxB;IACA,OAAO,IAAP;EACD;;EAEW,OAALC,KAAK,GAA4B;IACtC,OAAO,KAAKH,cAAL,GAAsBG,KAAtB,EAAP;EACD;;EAEDA,KAAK,GAA4B;IAC/B,MAAMD,gBAAgB,GAAG,KAAKA,gBAA9B;IACA,MAAME,iBAAiB,GAAG,KAAKC,eAA/B;IACA,OAAQC,MAAD,IAAoC;MACzC;;MACA,IAAIC,UAEH,GAAG,EAFJ;MAGA,MAAMC,aAEL,GAAG,EAFJ;;MAIA,IAAIN,gBAAJ,EAAsB;QACpBK,UAAU,GAAGL,gBAAgB,CAACI,MAAD,CAA7B;;QACA,KAAK,MAAMG,GAAX,IAAkBF,UAAlB,EAA8B;UAC5B,IAAI,CAACT,cAAc,CAACY,QAAf,CAAwBD,GAAxB,CAAL,EAAmC;YACjC,MAAME,KAAK,CAAE,aAAYF,GAAI,yBAAlB,CAAX;UACD;QACF;MACF,CAPD,MAOO;QACL,KAAK,MAAMG,QAAX,IAAuBd,cAAvB,EAAuC;UACrC,IAAIc,QAAQ,KAAK,WAAjB,EAA8B;YAC5B,MAAMC,MAAM,GAAGP,MAAM,CAACQ,qBAAtB;YACAP,UAAU,CAACQ,eAAX,GAA6BlB,UAAU,CAACgB,MAAD,EAAS;cAC9C;cACAG,QAAQ,EAAEZ;YAFoC,CAAT,CAAvC;UAID,CAND,MAMO;YACL,MAAMa,gBAAgB,GACpB,WAAWL,QAAQ,CAACM,MAAT,CAAgB,CAAhB,EAAmBC,WAAnB,EAAX,GAA8CP,QAAQ,CAACQ,KAAT,CAAe,CAAf,CADhD;YAEAb,UAAU,CAACK,QAAD,CAAV,GAAuBf,UAAU,CAACS,MAAM,CAACW,gBAAD,CAAP,EAA2B;cAC1D;cACAD,QAAQ,EAAEZ;YAFgD,CAA3B,CAAjC;UAID;QACF;MACF;;MAED,KAAK,MAAMQ,QAAX,IAAuBL,UAAvB,EAAmC;QACjC,IAAIK,QAAQ,KAAK,WAAjB,EAA8B;UAC5BJ,aAAa,CAACO,eAAd,GAAgCT,MAAM,CAACe,sBAAvC;QACD,CAFD,MAEO;UACL,MAAMC,iBAAiB,GACrB,YAAYV,QAAQ,CAACM,MAAT,CAAgB,CAAhB,EAAmBC,WAAnB,EAAZ,GAA+CP,QAAQ,CAACQ,KAAT,CAAe,CAAf,CADjD;UAEAZ,aAAa,CAACI,QAAD,CAAb,GAA0BN,MAAM,CAACgB,iBAAD,CAAhC;QACD;MACF;;MAED,OAAO;QAAEd,aAAF;QAAiBD;MAAjB,CAAP;IACD,CA9CD;EA+CD;;AAvE8D;AA0EjE,OAAO,MAAMgB,uBAAuB,GAAGxB,gBAAhC"}