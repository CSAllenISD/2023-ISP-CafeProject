{"version":3,"names":["Easing","defineAnimation","withTiming","toValue","userConfig","callback","config","duration","easing","inOut","quad","Object","keys","forEach","key","timing","animation","now","startTime","startValue","runtime","current","progress","onStart","value","previousAnimation","type","factory","onFrame"],"sources":["timing.ts"],"sourcesContent":["import { Easing, EasingFn, EasingFactoryFn } from '../Easing';\nimport { defineAnimation } from './util';\nimport {\n  Animation,\n  AnimationCallback,\n  Timestamp,\n  AnimatableValue,\n} from '../commonTypes';\n\ninterface TimingConfig {\n  duration?: number;\n  easing?: EasingFn | EasingFactoryFn;\n}\n\nexport interface TimingAnimation extends Animation<TimingAnimation> {\n  type: string;\n  easing: EasingFn;\n  startValue: AnimatableValue;\n  startTime: Timestamp;\n  progress: number;\n  toValue: AnimatableValue;\n  current: AnimatableValue;\n}\n\nexport interface InnerTimingAnimation\n  extends Omit<TimingAnimation, 'toValue' | 'current'> {\n  toValue: number;\n  current: number;\n}\n\nexport function withTiming(\n  toValue: AnimatableValue,\n  userConfig?: TimingConfig,\n  callback?: AnimationCallback\n): Animation<TimingAnimation> {\n  'worklet';\n\n  return defineAnimation<TimingAnimation>(toValue, () => {\n    'worklet';\n    const config: Required<TimingConfig> = {\n      duration: 300,\n      easing: Easing.inOut(Easing.quad),\n    };\n    if (userConfig) {\n      Object.keys(userConfig).forEach(\n        (key) =>\n          ((config as any)[key] = userConfig[key as keyof typeof userConfig])\n      );\n    }\n\n    function timing(animation: InnerTimingAnimation, now: Timestamp): boolean {\n      const { toValue, startTime, startValue } = animation;\n      const runtime = now - startTime;\n\n      if (runtime >= config.duration) {\n        // reset startTime to avoid reusing finished animation config in `start` method\n        animation.startTime = 0;\n        animation.current = toValue;\n        return true;\n      }\n      const progress = animation.easing(runtime / config.duration);\n      animation.current =\n        (startValue as number) + (toValue - (startValue as number)) * progress;\n      return false;\n    }\n\n    function onStart(\n      animation: TimingAnimation,\n      value: number,\n      now: Timestamp,\n      previousAnimation: Animation<TimingAnimation>\n    ): void {\n      if (\n        previousAnimation &&\n        (previousAnimation as TimingAnimation).type === 'timing' &&\n        (previousAnimation as TimingAnimation).toValue === toValue &&\n        (previousAnimation as TimingAnimation).startTime\n      ) {\n        // to maintain continuity of timing animations we check if we are starting\n        // new timing over the old one with the same parameters. If so, we want\n        // to copy animation timeline properties\n        animation.startTime = (previousAnimation as TimingAnimation).startTime;\n        animation.startValue = (\n          previousAnimation as TimingAnimation\n        ).startValue;\n      } else {\n        animation.startTime = now;\n        animation.startValue = value;\n      }\n      animation.current = value;\n      if (typeof config.easing === 'object') {\n        animation.easing = config.easing.factory();\n      } else {\n        animation.easing = config.easing;\n      }\n    }\n\n    return {\n      type: 'timing',\n      onFrame: timing,\n      onStart: onStart as (animation: TimingAnimation, now: number) => boolean,\n      progress: 0,\n      toValue,\n      startValue: 0,\n      startTime: 0,\n      easing: () => 0,\n      current: toValue,\n      callback,\n    } as TimingAnimation;\n  });\n}\n"],"mappings":"AAAA,SAASA,MAAT,QAAkD,WAAlD;AACA,SAASC,eAAT,QAAgC,QAAhC;AA6BA,OAAO,SAASC,UAAT,CACLC,OADK,EAELC,UAFK,EAGLC,QAHK,EAIuB;EAC5B;;EAEA,OAAOJ,eAAe,CAAkBE,OAAlB,EAA2B,MAAM;IACrD;;IACA,MAAMG,MAA8B,GAAG;MACrCC,QAAQ,EAAE,GAD2B;MAErCC,MAAM,EAAER,MAAM,CAACS,KAAP,CAAaT,MAAM,CAACU,IAApB;IAF6B,CAAvC;;IAIA,IAAIN,UAAJ,EAAgB;MACdO,MAAM,CAACC,IAAP,CAAYR,UAAZ,EAAwBS,OAAxB,CACGC,GAAD,IACIR,MAAD,CAAgBQ,GAAhB,IAAuBV,UAAU,CAACU,GAAD,CAFtC;IAID;;IAED,SAASC,MAAT,CAAgBC,SAAhB,EAAiDC,GAAjD,EAA0E;MACxE,MAAM;QAAEd,OAAF;QAAWe,SAAX;QAAsBC;MAAtB,IAAqCH,SAA3C;MACA,MAAMI,OAAO,GAAGH,GAAG,GAAGC,SAAtB;;MAEA,IAAIE,OAAO,IAAId,MAAM,CAACC,QAAtB,EAAgC;QAC9B;QACAS,SAAS,CAACE,SAAV,GAAsB,CAAtB;QACAF,SAAS,CAACK,OAAV,GAAoBlB,OAApB;QACA,OAAO,IAAP;MACD;;MACD,MAAMmB,QAAQ,GAAGN,SAAS,CAACR,MAAV,CAAiBY,OAAO,GAAGd,MAAM,CAACC,QAAlC,CAAjB;MACAS,SAAS,CAACK,OAAV,GACGF,UAAD,GAAyB,CAAChB,OAAO,GAAIgB,UAAZ,IAAqCG,QADhE;MAEA,OAAO,KAAP;IACD;;IAED,SAASC,OAAT,CACEP,SADF,EAEEQ,KAFF,EAGEP,GAHF,EAIEQ,iBAJF,EAKQ;MACN,IACEA,iBAAiB,IAChBA,iBAAD,CAAuCC,IAAvC,KAAgD,QADhD,IAECD,iBAAD,CAAuCtB,OAAvC,KAAmDA,OAFnD,IAGCsB,iBAAD,CAAuCP,SAJzC,EAKE;QACA;QACA;QACA;QACAF,SAAS,CAACE,SAAV,GAAuBO,iBAAD,CAAuCP,SAA7D;QACAF,SAAS,CAACG,UAAV,GACEM,iBADqB,CAErBN,UAFF;MAGD,CAbD,MAaO;QACLH,SAAS,CAACE,SAAV,GAAsBD,GAAtB;QACAD,SAAS,CAACG,UAAV,GAAuBK,KAAvB;MACD;;MACDR,SAAS,CAACK,OAAV,GAAoBG,KAApB;;MACA,IAAI,OAAOlB,MAAM,CAACE,MAAd,KAAyB,QAA7B,EAAuC;QACrCQ,SAAS,CAACR,MAAV,GAAmBF,MAAM,CAACE,MAAP,CAAcmB,OAAd,EAAnB;MACD,CAFD,MAEO;QACLX,SAAS,CAACR,MAAV,GAAmBF,MAAM,CAACE,MAA1B;MACD;IACF;;IAED,OAAO;MACLkB,IAAI,EAAE,QADD;MAELE,OAAO,EAAEb,MAFJ;MAGLQ,OAAO,EAAEA,OAHJ;MAILD,QAAQ,EAAE,CAJL;MAKLnB,OALK;MAMLgB,UAAU,EAAE,CANP;MAOLD,SAAS,EAAE,CAPN;MAQLV,MAAM,EAAE,MAAM,CART;MASLa,OAAO,EAAElB,OATJ;MAULE;IAVK,CAAP;EAYD,CAxEqB,CAAtB;AAyED"}