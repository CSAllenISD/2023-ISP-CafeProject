{"version":3,"names":["shouldBeUseWeb","MutableValue","Mapper","constructor","module","mapper","inputs","outputs","id","MAPPER_ID","extractMutablesFromArray","markDirty","dirty","maybeRequestRender","forEach","input","addListener","execute","array","res","extractMutables","value","push","Array","isArray","v","isWebDomElement","Object","keys","key","isWebNode","o","Node","nodeType","nodeName","isWebElement","HTMLElement"],"sources":["Mapper.ts"],"sourcesContent":["import { NestedObjectValues } from '../commonTypes';\nimport { shouldBeUseWeb } from '../PlatformChecker';\nimport { JSReanimated } from './commonTypes';\nimport MutableValue from './MutableValue';\n\nexport default class Mapper<T> {\n  static MAPPER_ID = 1;\n  id: number;\n  inputs: MutableValue<T>[];\n  outputs: MutableValue<T>[];\n  mapper: () => void;\n\n  dirty = true;\n\n  constructor(\n    module: JSReanimated,\n    mapper: () => void,\n    inputs: NestedObjectValues<MutableValue<T>>[] = [],\n    outputs: NestedObjectValues<MutableValue<T>>[] = []\n  ) {\n    this.id = Mapper.MAPPER_ID++;\n    this.inputs = this.extractMutablesFromArray(inputs);\n    this.outputs = this.extractMutablesFromArray(outputs);\n    this.mapper = mapper;\n\n    const markDirty = () => {\n      this.dirty = true;\n      module.maybeRequestRender();\n    };\n\n    this.inputs.forEach((input) => {\n      input.addListener(markDirty);\n    });\n  }\n\n  execute(): void {\n    this.dirty = false;\n    this.mapper();\n  }\n\n  extractMutablesFromArray<T>(\n    array: NestedObjectValues<MutableValue<T>>\n  ): MutableValue<T>[] {\n    const res: MutableValue<T>[] = [];\n\n    function extractMutables(value: NestedObjectValues<MutableValue<T>>) {\n      if (value == null) {\n        // return;\n      } else if (value instanceof MutableValue) {\n        res.push(value);\n      } else if (Array.isArray(value)) {\n        value.forEach((v) => extractMutables(v));\n      } else if (isWebDomElement(value)) {\n        // do nothing on dom elements\n        // without this check, we get a \"Maximum call size exceeded error\"\n      } else if (typeof value === 'object') {\n        Object.keys(value).forEach((key) => {\n          extractMutables(value[key]);\n        });\n      }\n    }\n\n    extractMutables(array);\n    return res;\n  }\n}\n\nfunction isWebDomElement(value: any) {\n  if (!shouldBeUseWeb()) {\n    return false;\n  }\n\n  // https://stackoverflow.com/a/384380/7869175\n  function isWebNode(o: any) {\n    return typeof Node === 'object'\n      ? o instanceof Node\n      : o &&\n          typeof o === 'object' &&\n          typeof o.nodeType === 'number' &&\n          typeof o.nodeName === 'string';\n  }\n\n  function isWebElement(o: any) {\n    return typeof HTMLElement === 'object'\n      ? o instanceof HTMLElement // DOM2\n      : o &&\n          typeof o === 'object' &&\n          o !== null &&\n          o.nodeType === 1 &&\n          typeof o.nodeName === 'string';\n  }\n\n  return isWebNode(value) || isWebElement(value);\n}\n"],"mappings":";;AACA,SAASA,cAAT,QAA+B,oBAA/B;AAEA,OAAOC,YAAP,MAAyB,gBAAzB;AAEA,eAAe,MAAMC,MAAN,CAAgB;EAS7BC,WAAW,CACTC,MADS,EAETC,MAFS,EAKT;IAAA,IAFAC,MAEA,uEAFgD,EAEhD;IAAA,IADAC,OACA,uEADiD,EACjD;;IAAA;;IAAA;;IAAA;;IAAA;;IAAA,+BAPM,IAON;;IACA,KAAKC,EAAL,GAAUN,MAAM,CAACO,SAAP,EAAV;IACA,KAAKH,MAAL,GAAc,KAAKI,wBAAL,CAA8BJ,MAA9B,CAAd;IACA,KAAKC,OAAL,GAAe,KAAKG,wBAAL,CAA8BH,OAA9B,CAAf;IACA,KAAKF,MAAL,GAAcA,MAAd;;IAEA,MAAMM,SAAS,GAAG,MAAM;MACtB,KAAKC,KAAL,GAAa,IAAb;MACAR,MAAM,CAACS,kBAAP;IACD,CAHD;;IAKA,KAAKP,MAAL,CAAYQ,OAAZ,CAAqBC,KAAD,IAAW;MAC7BA,KAAK,CAACC,WAAN,CAAkBL,SAAlB;IACD,CAFD;EAGD;;EAEDM,OAAO,GAAS;IACd,KAAKL,KAAL,GAAa,KAAb;IACA,KAAKP,MAAL;EACD;;EAEDK,wBAAwB,CACtBQ,KADsB,EAEH;IACnB,MAAMC,GAAsB,GAAG,EAA/B;;IAEA,SAASC,eAAT,CAAyBC,KAAzB,EAAqE;MACnE,IAAIA,KAAK,IAAI,IAAb,EAAmB,CACjB;MACD,CAFD,MAEO,IAAIA,KAAK,YAAYpB,YAArB,EAAmC;QACxCkB,GAAG,CAACG,IAAJ,CAASD,KAAT;MACD,CAFM,MAEA,IAAIE,KAAK,CAACC,OAAN,CAAcH,KAAd,CAAJ,EAA0B;QAC/BA,KAAK,CAACP,OAAN,CAAeW,CAAD,IAAOL,eAAe,CAACK,CAAD,CAApC;MACD,CAFM,MAEA,IAAIC,eAAe,CAACL,KAAD,CAAnB,EAA4B,CACjC;QACA;MACD,CAHM,MAGA,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;QACpCM,MAAM,CAACC,IAAP,CAAYP,KAAZ,EAAmBP,OAAnB,CAA4Be,GAAD,IAAS;UAClCT,eAAe,CAACC,KAAK,CAACQ,GAAD,CAAN,CAAf;QACD,CAFD;MAGD;IACF;;IAEDT,eAAe,CAACF,KAAD,CAAf;IACA,OAAOC,GAAP;EACD;;AA3D4B;;gBAAVjB,M,eACA,C;;AA6DrB,SAASwB,eAAT,CAAyBL,KAAzB,EAAqC;EACnC,IAAI,CAACrB,cAAc,EAAnB,EAAuB;IACrB,OAAO,KAAP;EACD,CAHkC,CAKnC;;;EACA,SAAS8B,SAAT,CAAmBC,CAAnB,EAA2B;IACzB,OAAO,OAAOC,IAAP,KAAgB,QAAhB,GACHD,CAAC,YAAYC,IADV,GAEHD,CAAC,IACC,OAAOA,CAAP,KAAa,QADf,IAEE,OAAOA,CAAC,CAACE,QAAT,KAAsB,QAFxB,IAGE,OAAOF,CAAC,CAACG,QAAT,KAAsB,QAL5B;EAMD;;EAED,SAASC,YAAT,CAAsBJ,CAAtB,EAA8B;IAC5B,OAAO,OAAOK,WAAP,KAAuB,QAAvB,GACHL,CAAC,YAAYK,WADV,CACsB;IADtB,EAEHL,CAAC,IACC,OAAOA,CAAP,KAAa,QADf,IAEEA,CAAC,KAAK,IAFR,IAGEA,CAAC,CAACE,QAAF,KAAe,CAHjB,IAIE,OAAOF,CAAC,CAACG,QAAT,KAAsB,QAN5B;EAOD;;EAED,OAAOJ,SAAS,CAACT,KAAD,CAAT,IAAoBc,YAAY,CAACd,KAAD,CAAvC;AACD"}