{"version":3,"names":["NativeReanimated","SensorType","JSReanimated","constructor","Map","makeShareableClone","value","__hostObjectShareableJSRef","installCoreFunctions","_callGuard","_valueUnpacker","scheduleOnUI","worklet","requestAnimationFrame","registerEventHandler","_eventHash","_eventHandler","unregisterEventHandler","_","enableLayoutAnimations","console","warn","registerSensor","sensorType","interval","iosReferenceFrame","eventHandler","getSensorName","window","sensor","initializeSensor","callback","ROTATION","qw","qx","qy","qz","quaternion","yaw","Math","atan2","pitch","sin","roll","interfaceOrientation","x","y","z","addEventListener","start","sensors","set","nextSensorId","unregisterSensor","id","get","undefined","stop","delete","subscribeForKeyboardEvents","unsubscribeFromKeyboardEvents","config","referenceFrame","frequency","ACCELEROMETER","Accelerometer","GYROSCOPE","Gyroscope","GRAVITY","GravitySensor","MAGNETIC_FIELD","Magnetometer","AbsoluteOrientationSensor"],"sources":["JSReanimated.ts"],"sourcesContent":["import { NativeReanimated } from '../NativeReanimated/NativeReanimated';\nimport {\n  SensorType,\n  ShareableRef,\n  Value3D,\n  ValueRotation,\n} from '../commonTypes';\nimport { WebSensor } from './WebSensor';\n\nexport default class JSReanimated extends NativeReanimated {\n  nextSensorId = 0;\n  sensors = new Map<number, WebSensor>();\n\n  constructor() {\n    super(false);\n  }\n\n  makeShareableClone<T>(value: T): ShareableRef<T> {\n    return { __hostObjectShareableJSRef: value };\n  }\n\n  installCoreFunctions(\n    _callGuard: <T extends Array<any>, U>(\n      fn: (...args: T) => U,\n      ...args: T\n    ) => void,\n    _valueUnpacker: <T>(value: T) => T\n  ): void {\n    // noop\n  }\n\n  scheduleOnUI<T>(worklet: ShareableRef<T>) {\n    // @ts-ignore web implementation has still not been updated after the rewrite, this will be addressed once the web implementation updates are ready\n    requestAnimationFrame(worklet);\n  }\n\n  registerEventHandler<T>(\n    _eventHash: string,\n    _eventHandler: ShareableRef<T>\n  ): string {\n    // noop\n    return '';\n  }\n\n  unregisterEventHandler(_: string): void {\n    // noop\n  }\n\n  enableLayoutAnimations() {\n    console.warn(\n      '[Reanimated] enableLayoutAnimations is not available for WEB yet'\n    );\n  }\n\n  registerSensor(\n    sensorType: SensorType,\n    interval: number,\n    iosReferenceFrame: number,\n    eventHandler: (data: Value3D | ValueRotation) => void\n  ): number {\n    if (!(this.getSensorName(sensorType) in window)) {\n      return -1;\n    }\n\n    const sensor: WebSensor = this.initializeSensor(sensorType, interval);\n    let callback;\n    if (sensorType === SensorType.ROTATION) {\n      callback = () => {\n        const [qw, qx, qy, qz] = sensor.quaternion;\n\n        // reference: https://stackoverflow.com/questions/5782658/extracting-yaw-from-a-quaternion\n        const yaw = Math.atan2(\n          2.0 * (qy * qz + qw * qx),\n          qw * qw - qx * qx - qy * qy + qz * qz\n        );\n        const pitch = Math.sin(-2.0 * (qx * qz - qw * qy));\n        const roll = Math.atan2(\n          2.0 * (qx * qy + qw * qz),\n          qw * qw + qx * qx - qy * qy - qz * qz\n        );\n        eventHandler({\n          qw,\n          qx,\n          qy,\n          qz,\n          yaw,\n          pitch,\n          roll,\n          interfaceOrientation: 0,\n        });\n      };\n    } else {\n      callback = () => {\n        const { x, y, z } = sensor;\n        eventHandler({ x, y, z, interfaceOrientation: 0 });\n      };\n    }\n    sensor.addEventListener('reading', callback);\n    sensor.start();\n\n    this.sensors.set(this.nextSensorId, sensor);\n    return this.nextSensorId++;\n  }\n\n  unregisterSensor(id: number): void {\n    const sensor: WebSensor | undefined = this.sensors.get(id);\n    if (sensor !== undefined) {\n      sensor.stop();\n      this.sensors.delete(id);\n    }\n  }\n\n  subscribeForKeyboardEvents(_: ShareableRef<number>): number {\n    console.warn(\n      '[Reanimated] useAnimatedKeyboard is not available on web yet.'\n    );\n    return -1;\n  }\n\n  unsubscribeFromKeyboardEvents(_: number): void {\n    // noop\n  }\n\n  initializeSensor(sensorType: SensorType, interval: number): WebSensor {\n    const config =\n      interval <= 0\n        ? { referenceFrame: 'device' }\n        : { frequency: 1000 / interval };\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return new window.Accelerometer(config);\n      case SensorType.GYROSCOPE:\n        return new window.Gyroscope(config);\n      case SensorType.GRAVITY:\n        return new window.GravitySensor(config);\n      case SensorType.MAGNETIC_FIELD:\n        return new window.Magnetometer(config);\n      case SensorType.ROTATION:\n        return new window.AbsoluteOrientationSensor(config);\n    }\n  }\n\n  getSensorName(sensorType: SensorType): string {\n    switch (sensorType) {\n      case SensorType.ACCELEROMETER:\n        return 'Accelerometer';\n      case SensorType.GRAVITY:\n        return 'GravitySensor';\n      case SensorType.GYROSCOPE:\n        return 'Gyroscope';\n      case SensorType.MAGNETIC_FIELD:\n        return 'Magnetometer';\n      case SensorType.ROTATION:\n        return 'AbsoluteOrientationSensor';\n    }\n  }\n}\n"],"mappings":"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"}