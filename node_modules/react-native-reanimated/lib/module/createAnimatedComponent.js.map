{"version":3,"names":["React","findNodeHandle","Platform","StyleSheet","WorkletEventHandler","setAndForwardRef","invariant","adaptViewConfig","RNRenderer","configureLayoutAnimations","enableLayoutAnimations","runOnUI","startMapper","stopMapper","isJest","isChromeDebugger","shouldBeUseWeb","initialUpdaterRun","DefaultSharedTransition","LayoutAnimationType","makeViewDescriptorsSet","getShadowNodeWrapperFromRef","updateProps","NativeReanimatedModule","isSharedValue","dummyListener","maybeBuild","layoutAnimationOrBuilder","isAnimationBuilder","value","build","flattenArray","array","Array","isArray","resultArr","_flattenArray","arr","forEach","item","push","onlyAnimatedStyles","styles","filter","style","viewDescriptors","isSameAnimatedStyle","style1","style2","viewsRef","isSameAnimatedProps","has","key","x","undefined","isInlineStyleTransform","transform","some","t","hasInlineStyles","Object","keys","styleValue","extractSharedValuesMapFromProps","props","inlineProps","entries","inlinePropsHasChanged","styles1","styles2","length","getInlinePropsUpdate","update","map","createAnimatedComponent","Component","options","prototype","isReactComponent","AnimatedComponent","constructor","getForwardedRef","forwardedRef","setLocalRef","ref","tag","layout","entering","exiting","sharedTransitionTag","LAYOUT","ENTERING","EXITING","sharedElementTransition","sharedTransitionStyle","SHARED_ELEMENT_TRANSITION","_component","animatedStyle","componentWillUnmount","_detachNativeEvents","_detachStyles","_detachInlineProps","componentDidMount","_attachNativeEvents","_attachAnimatedStyles","_attachInlineProps","_getEventViewRef","getScrollableNode","node","viewTag","setNativeProps","prop","current","registerForEvents","unregisterFromEvents","OS","_styles","remove","_viewTag","animatedProps","global","_IS_FABRIC","_removeShadowNodeFromRegistry","_reattachNativeEvents","prevProps","reattachNeeded","_updateFromNative","_getViewInfo","viewName","shadowNodeWrapper","viewConfig","hostInstance","findHostInstance_DEPRECATED","Error","_nativeTag","uiViewClassName","prevStyles","prevAnimatedProps","_animatedProps","hasReanimated2Props","hasOneSameStyle","prevStyle","isPresent","add","name","initial","newInlineProps","hasChanged","_inlineProps","_inlinePropsViewDescriptors","sharableViewDescriptors","maybeViewRef","native","items","Set","updaterFunction","_inlinePropsMapperId","values","componentDidUpdate","_filterNonAnimatedProps","inputProps","styleProp","processedStyle","_isFirstRender","initialStyle","updater","newStyle","flatten","animatedProp","eventNames","eventName","listeners","render","platformProps","select","web","default","collapsable","_setComponentRef","displayName","forwardRef"],"sources":["createAnimatedComponent.tsx"],"sourcesContent":["import React, { Component, ComponentType, MutableRefObject, Ref } from 'react';\nimport { findNodeHandle, Platform, StyleSheet } from 'react-native';\nimport WorkletEventHandler from './reanimated2/WorkletEventHandler';\nimport setAndForwardRef from './setAndForwardRef';\nimport './reanimated2/layoutReanimation/animationsManager';\nimport invariant from 'invariant';\nimport { adaptViewConfig } from './ConfigHelper';\nimport { RNRenderer } from './reanimated2/platform-specific/RNRenderer';\nimport {\n  configureLayoutAnimations,\n  enableLayoutAnimations,\n  runOnUI,\n  startMapper,\n  stopMapper,\n} from './reanimated2/core';\nimport {\n  isJest,\n  isChromeDebugger,\n  shouldBeUseWeb,\n} from './reanimated2/PlatformChecker';\nimport { initialUpdaterRun } from './reanimated2/animation';\nimport {\n  BaseAnimationBuilder,\n  DefaultSharedTransition,\n  EntryExitAnimationFunction,\n  ILayoutAnimationBuilder,\n  LayoutAnimationFunction,\n  LayoutAnimationType,\n} from './reanimated2/layoutReanimation';\nimport {\n  SharedValue,\n  StyleProps,\n  ShadowNodeWrapper,\n} from './reanimated2/commonTypes';\nimport {\n  makeViewDescriptorsSet,\n  ViewDescriptorsSet,\n  ViewRefSet,\n} from './reanimated2/ViewDescriptorsSet';\nimport { getShadowNodeWrapperFromRef } from './reanimated2/fabricUtils';\nimport updateProps from './reanimated2/UpdateProps';\nimport NativeReanimatedModule from './reanimated2/NativeReanimated';\nimport { isSharedValue } from './reanimated2';\n\nfunction dummyListener() {\n  // empty listener we use to assign to listener properties for which animated\n  // event is used.\n}\n\nfunction maybeBuild(\n  layoutAnimationOrBuilder:\n    | ILayoutAnimationBuilder\n    | LayoutAnimationFunction\n    | Keyframe\n): LayoutAnimationFunction | Keyframe {\n  const isAnimationBuilder = (\n    value: ILayoutAnimationBuilder | LayoutAnimationFunction | Keyframe\n  ): value is ILayoutAnimationBuilder =>\n    'build' in layoutAnimationOrBuilder &&\n    typeof layoutAnimationOrBuilder.build === 'function';\n\n  if (isAnimationBuilder(layoutAnimationOrBuilder)) {\n    return layoutAnimationOrBuilder.build();\n  } else {\n    return layoutAnimationOrBuilder;\n  }\n}\n\ntype NestedArray<T> = T | NestedArray<T>[];\nfunction flattenArray<T>(array: NestedArray<T>): T[] {\n  if (!Array.isArray(array)) {\n    return [array];\n  }\n  const resultArr: T[] = [];\n\n  const _flattenArray = (arr: NestedArray<T>[]): void => {\n    arr.forEach((item) => {\n      if (Array.isArray(item)) {\n        _flattenArray(item);\n      } else {\n        resultArr.push(item);\n      }\n    });\n  };\n  _flattenArray(array);\n  return resultArr;\n}\n\nfunction onlyAnimatedStyles(styles: StyleProps[]) {\n  return styles.filter((style) => style?.viewDescriptors);\n}\n\nfunction isSameAnimatedStyle(\n  style1?: StyleProps,\n  style2?: StyleProps\n): boolean {\n  // We cannot use equality check to compare useAnimatedStyle outputs directly.\n  // Instead, we can compare its viewsRefs.\n  return style1?.viewsRef === style2?.viewsRef;\n}\n\nconst isSameAnimatedProps = isSameAnimatedStyle;\n\nconst has = <K extends string>(\n  key: K,\n  x: unknown\n): x is { [key in K]: unknown } => {\n  if (typeof x === 'function' || typeof x === 'object') {\n    if (x === null || x === undefined) {\n      return false;\n    } else {\n      return key in x;\n    }\n  }\n  return false;\n};\n\nfunction isInlineStyleTransform(transform: any): boolean {\n  if (!transform) {\n    return false;\n  }\n  return transform.some((t: Record<string, any>) => hasInlineStyles(t));\n}\n\nfunction hasInlineStyles(style: StyleProps): boolean {\n  if (!style) {\n    return false;\n  }\n  return Object.keys(style).some((key) => {\n    const styleValue = style[key];\n    return (\n      isSharedValue(styleValue) ||\n      (key === 'transform' && isInlineStyleTransform(styleValue))\n    );\n  });\n}\n\nfunction extractSharedValuesMapFromProps(\n  props: AnimatedComponentProps<InitialComponentProps>\n): Record<string, any> {\n  const inlineProps: Record<string, any> = {};\n\n  for (const key in props) {\n    const value = props[key];\n    if (key === 'style') {\n      const styles = flattenArray<StyleProps>(props.style ?? []);\n      styles.forEach((style) => {\n        if (!style) {\n          return;\n        }\n        for (const [key, styleValue] of Object.entries(style)) {\n          if (isSharedValue(styleValue)) {\n            inlineProps[key] = styleValue;\n          } else if (\n            key === 'transform' &&\n            isInlineStyleTransform(styleValue)\n          ) {\n            inlineProps[key] = styleValue;\n          }\n        }\n      });\n    } else if (isSharedValue(value)) {\n      inlineProps[key] = value;\n    }\n  }\n\n  return inlineProps;\n}\n\nfunction inlinePropsHasChanged(styles1: StyleProps, styles2: StyleProps) {\n  if (Object.keys(styles1).length !== Object.keys(styles2).length) {\n    return true;\n  }\n\n  for (const key of Object.keys(styles1)) {\n    if (styles1[key] !== styles2[key]) return true;\n  }\n\n  return false;\n}\n\nfunction getInlinePropsUpdate(inlineProps: Record<string, any>) {\n  'worklet';\n  const update: Record<string, any> = {};\n  for (const [key, styleValue] of Object.entries(inlineProps)) {\n    if (key === 'transform') {\n      update[key] = styleValue.map((transform: Record<string, any>) => {\n        return getInlinePropsUpdate(transform);\n      });\n    } else if (isSharedValue(styleValue)) {\n      update[key] = styleValue.value;\n    } else {\n      update[key] = styleValue;\n    }\n  }\n  return update;\n}\n\ninterface AnimatedProps extends Record<string, unknown> {\n  viewDescriptors?: ViewDescriptorsSet;\n  viewsRef?: ViewRefSet<unknown>;\n  initial?: SharedValue<StyleProps>;\n}\n\nexport type AnimatedComponentProps<P extends Record<string, unknown>> = P & {\n  forwardedRef?: Ref<Component>;\n  style?: NestedArray<StyleProps>;\n  animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n  animatedStyle?: StyleProps;\n  layout?:\n    | BaseAnimationBuilder\n    | ILayoutAnimationBuilder\n    | typeof BaseAnimationBuilder;\n  entering?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n  exiting?:\n    | BaseAnimationBuilder\n    | typeof BaseAnimationBuilder\n    | EntryExitAnimationFunction\n    | Keyframe;\n  sharedTransitionTag?: string;\n  sharedTransitionStyle?: ILayoutAnimationBuilder;\n};\n\ntype Options<P> = {\n  setNativeProps: (ref: ComponentRef, props: P) => void;\n};\n\ninterface ComponentRef extends Component {\n  setNativeProps?: (props: Record<string, unknown>) => void;\n  getScrollableNode?: () => ComponentRef;\n}\n\nexport interface InitialComponentProps extends Record<string, unknown> {\n  ref?: Ref<Component>;\n  collapsable?: boolean;\n}\n\nexport default function createAnimatedComponent(\n  Component: ComponentType<InitialComponentProps>,\n  options?: Options<InitialComponentProps>\n): ComponentType<AnimatedComponentProps<InitialComponentProps>> {\n  invariant(\n    typeof Component !== 'function' ||\n      (Component.prototype && Component.prototype.isReactComponent),\n    '`createAnimatedComponent` does not support stateless functional components; ' +\n      'use a class component instead.'\n  );\n\n  class AnimatedComponent extends React.Component<\n    AnimatedComponentProps<InitialComponentProps>\n  > {\n    _styles: StyleProps[] | null = null;\n    _animatedProps?: Partial<AnimatedComponentProps<AnimatedProps>>;\n    _viewTag = -1;\n    _isFirstRender = true;\n    animatedStyle: { value: StyleProps } = { value: {} };\n    initialStyle = {};\n    _component: ComponentRef | null = null;\n    _inlinePropsViewDescriptors: ViewDescriptorsSet | null = null;\n    _inlinePropsMapperId: number | null = null;\n    _inlineProps: StyleProps = {};\n    static displayName: string;\n\n    constructor(props: AnimatedComponentProps<InitialComponentProps>) {\n      super(props);\n      if (isJest()) {\n        this.animatedStyle = { value: {} };\n      }\n    }\n\n    componentWillUnmount() {\n      this._detachNativeEvents();\n      this._detachStyles();\n      this._detachInlineProps();\n    }\n\n    componentDidMount() {\n      this._attachNativeEvents();\n      this._attachAnimatedStyles();\n      this._attachInlineProps();\n    }\n\n    _getEventViewRef() {\n      // Make sure to get the scrollable node for components that implement\n      // `ScrollResponder.Mixin`.\n      return this._component?.getScrollableNode\n        ? this._component.getScrollableNode()\n        : this._component;\n    }\n\n    _attachNativeEvents() {\n      const node = this._getEventViewRef();\n      const viewTag = findNodeHandle(options?.setNativeProps ? this : node);\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.registerForEvents(viewTag as number, key);\n        }\n      }\n    }\n\n    _detachNativeEvents() {\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n    }\n\n    _detachStyles() {\n      if (Platform.OS === 'web' && this._styles !== null) {\n        for (const style of this._styles) {\n          if (style?.viewsRef) {\n            style.viewsRef.remove(this);\n          }\n        }\n      } else if (this._viewTag !== -1 && this._styles !== null) {\n        for (const style of this._styles) {\n          style.viewDescriptors.remove(this._viewTag);\n        }\n        if (this.props.animatedProps?.viewDescriptors) {\n          this.props.animatedProps.viewDescriptors.remove(this._viewTag);\n        }\n        if (global._IS_FABRIC) {\n          const viewTag = this._viewTag;\n          runOnUI(() => {\n            'worklet';\n            _removeShadowNodeFromRegistry(viewTag);\n          })();\n        }\n      }\n    }\n\n    _reattachNativeEvents(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      let viewTag: number | undefined;\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler\n        ) {\n          if (viewTag === undefined) {\n            viewTag = prop.current.viewTag;\n          }\n        }\n      }\n      for (const key in prevProps) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          prop.current.unregisterFromEvents();\n        }\n      }\n\n      for (const key in this.props) {\n        const prop = this.props[key];\n        if (\n          has('current', prop) &&\n          prop.current instanceof WorkletEventHandler &&\n          prop.current.reattachNeeded\n        ) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          prop.current.registerForEvents(viewTag!, key);\n          prop.current.reattachNeeded = false;\n        }\n      }\n    }\n\n    _updateFromNative(props: StyleProps) {\n      if (options?.setNativeProps) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        options.setNativeProps(this._component!, props);\n      } else {\n        // eslint-disable-next-line no-unused-expressions\n        this._component?.setNativeProps?.(props);\n      }\n    }\n\n    _getViewInfo() {\n      let viewTag: number | null;\n      let viewName: string | null;\n      let shadowNodeWrapper: ShadowNodeWrapper | null = null;\n      let viewConfig;\n      if (Platform.OS === 'web') {\n        viewTag = findNodeHandle(this);\n        viewName = null;\n        shadowNodeWrapper = null;\n        viewConfig = null;\n      } else {\n        // hostInstance can be null for a component that doesn't render anything (render function returns null). Example: svg Stop: https://github.com/react-native-svg/react-native-svg/blob/develop/src/elements/Stop.tsx\n        const hostInstance = RNRenderer.findHostInstance_DEPRECATED(this);\n        if (!hostInstance) {\n          throw new Error(\n            'Cannot find host instance for this component. Maybe it renders nothing?'\n          );\n        }\n        // we can access view tag in the same way it's accessed here https://github.com/facebook/react/blob/e3f4eb7272d4ca0ee49f27577156b57eeb07cf73/packages/react-native-renderer/src/ReactFabric.js#L146\n        viewTag = hostInstance?._nativeTag;\n        /**\n         * RN uses viewConfig for components for storing different properties of the component(example: https://github.com/facebook/react-native/blob/master/Libraries/Components/ScrollView/ScrollViewViewConfig.js#L16).\n         * The name we're looking for is in the field named uiViewClassName.\n         */\n        viewName = hostInstance?.viewConfig?.uiViewClassName;\n\n        viewConfig = hostInstance?.viewConfig;\n\n        if (global._IS_FABRIC) {\n          shadowNodeWrapper = getShadowNodeWrapperFromRef(this);\n        }\n      }\n      return { viewTag, viewName, shadowNodeWrapper, viewConfig };\n    }\n\n    _attachAnimatedStyles() {\n      const styles = this.props.style\n        ? onlyAnimatedStyles(flattenArray<StyleProps>(this.props.style))\n        : [];\n      const prevStyles = this._styles;\n      this._styles = styles;\n\n      const prevAnimatedProps = this._animatedProps;\n      this._animatedProps = this.props.animatedProps;\n\n      const { viewTag, viewName, shadowNodeWrapper, viewConfig } =\n        this._getViewInfo();\n\n      // update UI props whitelist for this view\n      const hasReanimated2Props =\n        this.props.animatedProps?.viewDescriptors || styles.length;\n      if (hasReanimated2Props && viewConfig) {\n        adaptViewConfig(viewConfig);\n      }\n\n      this._viewTag = viewTag as number;\n\n      // remove old styles\n      if (prevStyles) {\n        // in most of the cases, views have only a single animated style and it remains unchanged\n        const hasOneSameStyle =\n          styles.length === 1 &&\n          prevStyles.length === 1 &&\n          isSameAnimatedStyle(styles[0], prevStyles[0]);\n\n        if (!hasOneSameStyle) {\n          // otherwise, remove each style that is not present in new styles\n          for (const prevStyle of prevStyles) {\n            const isPresent = styles.some((style) =>\n              isSameAnimatedStyle(style, prevStyle)\n            );\n            if (!isPresent) {\n              prevStyle.viewDescriptors.remove(viewTag);\n            }\n          }\n        }\n      }\n\n      styles.forEach((style) => {\n        style.viewDescriptors.add({\n          tag: viewTag,\n          name: viewName,\n          shadowNodeWrapper,\n        });\n        if (isJest()) {\n          /**\n           * We need to connect Jest's TestObject instance whose contains just props object\n           * with the updateProps() function where we update the properties of the component.\n           * We can't update props object directly because TestObject contains a copy of props - look at render function:\n           * const props = this._filterNonAnimatedProps(this.props);\n           */\n          this.animatedStyle.value = {\n            ...this.animatedStyle.value,\n            ...style.initial.value,\n          };\n          style.animatedStyle.current = this.animatedStyle;\n        }\n      });\n\n      // detach old animatedProps\n      if (\n        prevAnimatedProps &&\n        !isSameAnimatedProps(prevAnimatedProps, this.props.animatedProps)\n      ) {\n        prevAnimatedProps.viewDescriptors!.remove(viewTag as number);\n      }\n\n      // attach animatedProps property\n      if (this.props.animatedProps?.viewDescriptors) {\n        this.props.animatedProps.viewDescriptors.add({\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          tag: viewTag!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          name: viewName!,\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          shadowNodeWrapper: shadowNodeWrapper!,\n        });\n      }\n    }\n\n    _attachInlineProps() {\n      const newInlineProps: Record<string, any> =\n        extractSharedValuesMapFromProps(this.props);\n      const hasChanged = inlinePropsHasChanged(\n        newInlineProps,\n        this._inlineProps\n      );\n\n      if (hasChanged) {\n        if (!this._inlinePropsViewDescriptors) {\n          this._inlinePropsViewDescriptors = makeViewDescriptorsSet();\n\n          const { viewTag, viewName, shadowNodeWrapper, viewConfig } =\n            this._getViewInfo();\n\n          if (Object.keys(newInlineProps).length && viewConfig) {\n            adaptViewConfig(viewConfig);\n          }\n\n          this._inlinePropsViewDescriptors.add({\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            tag: viewTag!,\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            name: viewName!,\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            shadowNodeWrapper: shadowNodeWrapper!,\n          });\n        }\n        const sharableViewDescriptors =\n          this._inlinePropsViewDescriptors.sharableViewDescriptors;\n\n        const maybeViewRef = NativeReanimatedModule.native\n          ? undefined\n          : ({ items: new Set([this]) } as ViewRefSet<any>); // see makeViewsRefSet\n\n        const updaterFunction = () => {\n          'worklet';\n          const update = getInlinePropsUpdate(newInlineProps);\n          updateProps(sharableViewDescriptors, update, maybeViewRef);\n        };\n        this._inlineProps = newInlineProps;\n        if (this._inlinePropsMapperId) {\n          stopMapper(this._inlinePropsMapperId);\n        }\n        this._inlinePropsMapperId = null;\n        if (Object.keys(newInlineProps).length) {\n          this._inlinePropsMapperId = startMapper(\n            updaterFunction,\n            Object.values(newInlineProps)\n          );\n        }\n      }\n    }\n\n    _detachInlineProps() {\n      if (this._inlinePropsMapperId) {\n        stopMapper(this._inlinePropsMapperId);\n      }\n    }\n\n    componentDidUpdate(\n      prevProps: AnimatedComponentProps<InitialComponentProps>\n    ) {\n      this._reattachNativeEvents(prevProps);\n      this._attachAnimatedStyles();\n      this._attachInlineProps();\n    }\n\n    _setComponentRef = setAndForwardRef<Component>({\n      getForwardedRef: () =>\n        this.props.forwardedRef as MutableRefObject<\n          Component<Record<string, unknown>, Record<string, unknown>, unknown>\n        >,\n      setLocalRef: (ref) => {\n        // TODO update config\n        const tag = findNodeHandle(ref);\n        const { layout, entering, exiting, sharedTransitionTag } = this.props;\n        if (\n          (layout || entering || exiting || sharedTransitionTag) &&\n          tag != null\n        ) {\n          if (!shouldBeUseWeb()) {\n            enableLayoutAnimations(true, false);\n          }\n          if (layout) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.LAYOUT,\n              maybeBuild(layout)\n            );\n          }\n          if (entering) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.ENTERING,\n              maybeBuild(entering)\n            );\n          }\n          if (exiting) {\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.EXITING,\n              maybeBuild(exiting)\n            );\n          }\n          if (sharedTransitionTag) {\n            const sharedElementTransition =\n              this.props.sharedTransitionStyle ?? DefaultSharedTransition;\n            configureLayoutAnimations(\n              tag,\n              LayoutAnimationType.SHARED_ELEMENT_TRANSITION,\n              maybeBuild(sharedElementTransition),\n              sharedTransitionTag\n            );\n          }\n        }\n\n        if (ref !== this._component) {\n          this._component = ref;\n        }\n      },\n    });\n\n    _filterNonAnimatedProps(\n      inputProps: AnimatedComponentProps<InitialComponentProps>\n    ): Record<string, unknown> {\n      const props: Record<string, unknown> = {};\n      for (const key in inputProps) {\n        const value = inputProps[key];\n        if (key === 'style') {\n          const styleProp = inputProps.style;\n          const styles = flattenArray<StyleProps>(styleProp ?? []);\n          const processedStyle: StyleProps = styles.map((style) => {\n            if (style && style.viewDescriptors) {\n              // this is how we recognize styles returned by useAnimatedStyle\n              style.viewsRef.add(this);\n              if (this._isFirstRender) {\n                this.initialStyle = {\n                  ...style.initial.value,\n                  ...initialUpdaterRun<StyleProps>(style.initial.updater),\n                };\n              }\n              return this.initialStyle;\n            } else if (hasInlineStyles(style)) {\n              if (this._isFirstRender) {\n                return getInlinePropsUpdate(style);\n              }\n              const newStyle: StyleProps = {};\n              for (const [key, styleValue] of Object.entries(style)) {\n                if (\n                  !isSharedValue(styleValue) &&\n                  !(key === 'transform' && isInlineStyleTransform(styleValue))\n                ) {\n                  newStyle[key] = styleValue;\n                }\n              }\n              return newStyle;\n            } else {\n              return style;\n            }\n          });\n          props[key] = StyleSheet.flatten(processedStyle);\n        } else if (key === 'animatedProps') {\n          const animatedProp = inputProps.animatedProps as Partial<\n            AnimatedComponentProps<AnimatedProps>\n          >;\n          if (animatedProp.initial !== undefined) {\n            Object.keys(animatedProp.initial.value).forEach((key) => {\n              props[key] = animatedProp.initial?.value[key];\n              animatedProp.viewsRef?.add(this);\n            });\n          }\n        } else if (\n          has('current', value) &&\n          value.current instanceof WorkletEventHandler\n        ) {\n          if (value.current.eventNames.length > 0) {\n            value.current.eventNames.forEach((eventName) => {\n              props[eventName] = has('listeners', value.current)\n                ? (value.current.listeners as Record<string, unknown>)[\n                    eventName\n                  ]\n                : dummyListener;\n            });\n          } else {\n            props[key] = dummyListener;\n          }\n        } else if (isSharedValue(value)) {\n          if (this._isFirstRender) {\n            props[key] = (value as SharedValue<any>).value;\n          }\n        } else if (\n          key !== 'onGestureHandlerStateChange' ||\n          !isChromeDebugger()\n        ) {\n          props[key] = value;\n        }\n      }\n      return props;\n    }\n\n    render() {\n      const props = this._filterNonAnimatedProps(this.props);\n      if (isJest()) {\n        props.animatedStyle = this.animatedStyle;\n      }\n\n      if (this._isFirstRender) {\n        this._isFirstRender = false;\n      }\n\n      const platformProps = Platform.select({\n        web: {},\n        default: { collapsable: false },\n      });\n      return (\n        <Component {...props} ref={this._setComponentRef} {...platformProps} />\n      );\n    }\n  }\n\n  AnimatedComponent.displayName = `AnimatedComponent(${\n    Component.displayName || Component.name || 'Component'\n  })`;\n\n  return React.forwardRef<Component>((props, ref) => {\n    return (\n      <AnimatedComponent\n        {...props}\n        {...(ref === null ? null : { forwardedRef: ref })}\n      />\n    );\n  });\n}\n"],"mappings":"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"}